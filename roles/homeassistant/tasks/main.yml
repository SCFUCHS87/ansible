---
- name: Pull Home Assistant image
  docker_image:
    name: "ghcr.io/home-assistant/home-assistant:{{ homeassistant_version | default('stable') }}"
    source: pull

- name: Run Home Assistant container
  docker_container:
    name: homeassistant
    image: "ghcr.io/home-assistant/home-assistant:{{ homeassistant_version | default('stable') }}"
    restart_policy: unless-stopped
    network_mode: host
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /opt/homeassistant:/config
    env:
      TZ: "{{ timezone | default('UTC') }}"

- name: Wait for Home Assistant to start
  wait_for:
    host: "{{ ansible_default_ipv4.address }}"
    port: 8123
    delay: 10
    timeout: 60
  ignore_errors: true

- name: Display Home Assistant access info
  debug:
    msg: "Home Assistant available at: http://{{ ansible_default_ipv4.address }}:8123"
